<?xml version='1.0' encoding='UTF-8'?>
<project name="Service Archive" default='run' basedir=".">

   <!-- Taskdefs required when running this script from the command line. -->
   <taskdef name="validatebpr" classname="com.activee.ant.bpr.tasks.AeValidateBPRTask" />
   <taskdef name="deploybpr" classname="com.activee.ant.bpr.tasks.AeDeployBPRTask" />
   <taskdef name="createcatalog" classname="com.activee.ant.bpr.tasks.AeCreateCatalogTask" />

   <!-- The project root location. -->
   <property name="project_loc" value="/Users/markford/Documents/workspace/bpel-g/bpelpeople.test" />

   <!-- Some properties used by the script. -->
   <property name="archive.filename" value="${project_loc}/../../../workspace-ganymede/test.bpr" />

   <!-- The deployment location.  Typically a server/container deployment directory. -->
   <property name="archive.deploypath" value="" />

   <!-- A temp directory location. -->
   <property name="archive.temppath" value="${java.io.tmpdir}" />

   <!-- Build the BPR file from the following (generated) file set. -->
   <target name="build" depends="">
      <delete file="${archive.filename}" />
      <jar destfile="${archive.filename}">
         <!-- PDD Files. -->
         <zipfileset file="${project_loc}/deploy/test.pdd" fullpath="META-INF/pdd/bpelpeople.test/deploy/test.pdd" />
         <zipfileset file="${project_loc}/deploy/testInvoke.pdd" fullpath="META-INF/pdd/bpelpeople.test/deploy/testInvoke.pdd" />
         <zipfileset file="${project_loc}/deploy/testInvokeBpelReceiver.pdd" fullpath="META-INF/pdd/bpelpeople.test/deploy/testInvokeBpelReceiver.pdd" />
         <!-- BPEL Files. -->
         <zipfileset file="${project_loc}/bpel/test.bpel" fullpath="bpel/bpelpeople.test/bpel/test.bpel" />
         <zipfileset file="${project_loc}/bpel/testInvoke.bpel" fullpath="bpel/bpelpeople.test/bpel/testInvoke.bpel" />
         <zipfileset file="${project_loc}/bpel/testInvokeBpelReceiver.bpel" fullpath="bpel/bpelpeople.test/bpel/testInvokeBpelReceiver.bpel" />
         <!-- WSDL Files. -->
         <zipfileset file="${project_loc}/wsdl/test.wsdl" fullpath="wsdl/Users/markford/Documents/workspace/bpel-g/bpelpeople.test/wsdl/test.wsdl" />
      </jar>
      <createcatalog file="${archive.filename}">
         <wsdlentry location="project:/bpelpeople.test/wsdl/test.wsdl" classpath="wsdl/Users/markford/Documents/workspace/bpel-g/bpelpeople.test/wsdl/test.wsdl" />
      </createcatalog>
   </target>

   <!-- Validate the BPR once it is built. -->
   <target name="validate" depends="">
      <echo message="Validating the Business Process Archive..." />
      <validatebpr file="${archive.filename}" />
      <echo message="Validation completed successfully." />
   </target>

   <!-- Deploy the built BPR file to some kind of container/server. -->
   <target name="deploy" depends="">
      <echo message="Deploying Business Process Archive." />
      <!-- 
         **** deploybpr task usage: **** 
         @type: Either 'file' or 'webservice'.
         @file: The path to the BPR file created by the build target.
         @todir: The path to deploy the BPR to when @type is 'file'.
         @tourl: The URL of the server to deploy the BPR to when @type is 'webservice'.
         @username: A username to use to authenticate when @type is 'webservice'.
         @password: A password to use to authenticate when @type is 'webservice'.
      -->
      <deploybpr type="file" file="${archive.filename}" todir="${archive.deploypath}" />
      <echo message="Business Process Archive deployed." />
   </target>

   <!-- The main entry point into this script, the run target calls various other targets in turn. -->
   <target name="run" depends="build,validate"/>

   <target name="runDeploy" depends="run,deploy"/>

</project>
